<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>ì¤€í˜¸ì˜ ë§ˆë²• IDE</title>
<link rel="apple-touch-icon" href="icon.png" />
<meta name="apple-mobile-web-app-title" content="ì¤€í˜¸ì˜ ë§ˆë²• IDE" /> 
<style>
  /* ì „ì²´ ë ˆì´ì•„ì›ƒ */
  body, html {
    margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1e1e1e; color: #ddd;
  }
  header {
    height: 40px; background: #007acc; display: flex; align-items: center; justify-content: space-between; padding: 0 12px; color: white;
    user-select: none;
  }
  #container {
    flex: 1; display: flex; overflow: hidden;
  }
  #sidebar {
    width: 240px; background: #252526; color: #bbb; overflow-y: auto; border-right: 1px solid #333;
  }
  #sidebar h2 {
    margin: 8px 12px;
    font-weight: 600;
    font-size: 1.1em;
    border-bottom: 1px solid #444;
    padding-bottom: 4px;
  }
  #fileList {
    list-style: none; padding: 0; margin: 0;
  }
  #fileList li {
    padding: 6px 12px; cursor: pointer; display: flex; align-items: center; gap: 6px;
  }
  #fileList li:hover, #fileList li.active {
    background: #0e639c;
    color: white;
  }
  #fileList li .icon {
    font-size: 1.2em;
    width: 20px; text-align: center;
  }
  #editor {
    flex: 1;
    background: #1e1e1e;
  }
  #keyboard {
    height: 50px;
    background: #333;
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    overflow-x: auto;
    padding: 0 8px;
    user-select: none;
  }
  #keyboard .key {
    background: #555;
    color: white;
    margin: 0 4px;
    padding: 8px 12px;
    border-radius: 4px;
    font-weight: 700;
    cursor: pointer;
    flex-shrink: 0;
    user-select: none;
    transition: background 0.15s ease;
    font-family: monospace;
  }
  #keyboard .key:hover {
    background: #0e639c;
  }
  #footer {
    height: 100px;
    background: #1e1e1e;
    color: #bbb;
    font-family: monospace;
    font-size: 14px;
    overflow-y: auto;
    border-top: 1px solid #333;
    padding: 8px;
  }
  button {
    background: #0e639c;
    border: none;
    padding: 6px 12px;
    color: white;
    font-weight: 600;
    border-radius: 3px;
    cursor: pointer;
    user-select: none;
  }
  button:hover {
    background: #1177d3;
  }
  /* ëª¨ë°”ì¼ ì„¸ë¡œëª¨ë“œ ëŒ€ì‘ */
  @media (orientation: portrait) {
    #container {
      flex-direction: column;
    }
    #sidebar {
      width: 100%;
      height: 140px;
      border-right: none;
      border-bottom: 1px solid #333;
      overflow-x: auto;
      overflow-y: hidden;
      display: flex;
      flex-wrap: nowrap;
    }
    #fileList {
      display: flex;
      flex-wrap: nowrap;
    }
    #fileList li {
      flex: 0 0 auto;
      padding: 6px 16px;
      white-space: nowrap;
      border-right: 1px solid #444;
    }
    #editor {
      flex: 1;
      height: 50vh;
    }
    #footer {
      height: 80px;
      font-size: 12px;
    }
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>
</head>
<body>

<header>
  <div>ì¤€í˜¸ì˜ ë§ˆë²• IDE</div>
  <div>
    <button id="openFolderBtn">í´ë”/íŒŒì¼ ì—´ê¸°</button>
    <button id="saveBtn">ì €ì¥ ğŸ’¾</button>
    <button id="runBtn">ì‹¤í–‰ â–¶</button>
  </div>
</header>

<div id="container">
  <nav id="sidebar">
    <h2>íŒŒì¼ ëª©ë¡</h2>
    <ul id="fileList"></ul>
  </nav>
  <main id="editor"></main>
</div>

<div id="keyboard">
  <div class="key" data-key="âŒ˜">âŒ˜</div>
  <div class="key" data-key="âŒ¥">âŒ¥</div>
  <div class="key" data-key="âŒƒ">âŒƒ</div>
  <div class="key" data-key="â‡§">â‡§</div>
  <div class="key" data-key="â‹">â‹</div>
  <div class="key" data-key="âŒ«">âŒ«</div>
  <div class="key" data-key="â‡¥">â‡¥</div>
  <div class="key" data-key="{}">{}</div>
  <div class="key" data-key="()">( )</div>
  <div class="key" data-key="[]">[ ]</div>
  <div class="key" data-key="<>">&lt;&gt;</div>
  <div class="key" data-key=";">;</div>
</div>

<div id="footer" contenteditable="false" spellcheck="false"></div>

<script>
  const iconMap = {
    js: 'ğŸ“„',
    ts: 'ğŸ§ ',
    html: 'ğŸŒ',
    css: 'ğŸ¨',
    json: 'ğŸ—‚ï¸',
    py: 'ğŸ',
    java: 'â˜•',
    asm: 'âš™ï¸',
    sh: 'ğŸš',
    cmd: 'ğŸ’»',
    ps1: 'âš¡',
    swift: 'ğŸ¦…'
  };

  const supportedExts = Object.keys(iconMap);

  let currentFileHandle = null;
  let files = [];
  let editor = null;

  function getLanguageFromExt(ext) {
    switch (ext) {
      case 'js': return 'javascript';
      case 'ts': return 'typescript';
      case 'html': return 'html';
      case 'css': return 'css';
      case 'json': return 'json';
      case 'py': return 'python';
      case 'java': return 'java';
      case 'asm': return 'plaintext'; // asmì€ ê¸°ë³¸ ì§€ì› ì—†ìŒ
      case 'sh': return 'shell';
      case 'cmd': return 'bat';
      case 'ps1': return 'powershell';
      case 'swift': return 'swift';
      default: return 'plaintext';
    }
  }

  require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs' }});
  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(document.getElementById('editor'), {
      value: '',
      language: 'plaintext',
      theme: 'vs-dark',
      automaticLayout: true,
      fontSize: 14,
      minimap: { enabled: false }
    });
  });

  function renderFileList() {
    const fileList = document.getElementById('fileList');
    fileList.innerHTML = '';
    files.forEach((f, i) => {
      const ext = f.name.split('.').pop().toLowerCase();
      const icon = iconMap[ext] || 'ğŸ“';
      const li = document.createElement('li');
      li.className = (currentFileHandle === f.handle) ? 'active' : '';
      li.innerHTML = `<span class="icon">${icon}</span> ${f.name}`;
      li.onclick = () => openFileInEditor(i);
      fileList.appendChild(li);
    });
  }

  async function openFileInEditor(index) {
    const file = files[index];
    editor.setValue(file.content);
    currentFileHandle = file.handle;

    const ext = file.name.split('.').pop().toLowerCase();
    const lang = getLanguageFromExt(ext);
    monaco.editor.setModelLanguage(editor.getModel(), lang);

    renderFileList();
  }

  async function openFolderOrFiles() {
    files = [];
    currentFileHandle = null;

    if ('showDirectoryPicker' in window) {
      try {
        const dirHandle = await window.showDirectoryPicker();
        await traverseDir(dirHandle);
        if(files.length) openFileInEditor(0);
        renderFileList();
      } catch (e) {
        alert('í´ë” ì—´ê¸° ì·¨ì†Œë¨ ë˜ëŠ” ì˜¤ë¥˜: ' + e.message);
      }
    } else if ('showOpenFilePicker' in window) {
      try {
        const pickedFiles = await window.showOpenFilePicker({multiple: true});
        for (const fh of pickedFiles) {
          const fileData = await fh.getFile();
          const content = await fileData.text();
          files.push({name: fileData.name, content, handle: fh});
        }
        if(files.length) openFileInEditor(0);
        renderFileList();
      } catch(e) {
        alert('íŒŒì¼ ì—´ê¸° ì·¨ì†Œë¨ ë˜ëŠ” ì˜¤ë¥˜: ' + e.message);
      }
    } else {
      alert('íŒŒì¼/í´ë” ì—´ê¸° APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
    }
  }

  async function traverseDir(dirHandle) {
    for await (const [name, handle] of dirHandle.entries()) {
      if(handle.kind === 'file') {
        const ext = name.split('.').pop().toLowerCase();
        if(supportedExts.includes(ext)) {
          const fileData = await handle.getFile();
          const content = await fileData.text();
          files.push({name, content, handle});
        }
      } else if(handle.kind === 'directory') {
        await traverseDir(handle);
      }
    }
  }

  async function saveCurrentFile() {
    if (!currentFileHandle) {
      alert('ì €ì¥í•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤!');
      return;
    }
    try {
      const writable = await currentFileHandle.createWritable();
      await writable.write(editor.getValue());
      await writable.close();
      alert('ì €ì¥ ì™„ë£Œ!');
      // ë‚´ë¶€ ë‚´ìš© ì—…ë°ì´íŠ¸
      const idx = files.findIndex(f => f.handle === currentFileHandle);
      if(idx !== -1) files[idx].content = editor.getValue();
    } catch(e) {
      alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
    }
  }

  function runCode() {
    const lang = editor.getModel().getLanguageId();
    const code = editor.getValue();

    if(lang === 'javascript' || lang === 'typescript') {
      try {
        // eslint-disable-next-line no-eval
        const result = eval(code);
        showOutput(result === undefined ? 'ì‹¤í–‰ ì™„ë£Œ, ê²°ê³¼ ì—†ìŒ' : result);
      } catch(e) {
        showOutput('ì‹¤í–‰ ì˜¤ë¥˜: ' + e.message);
      }
    } else {
      showOutput('ì´ ì–¸ì–´ëŠ” ì§ì ‘ ì‹¤í–‰ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + lang);
    }
  }

  function showOutput(text) {
    const footer = document.getElementById('footer');
    footer.textContent = String(text);
  }

  // ì „ìš© í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì˜ˆì‹œ)
  const keyboard = document.getElementById('keyboard');
  keyboard.addEventListener('click', e => {
    if(!e.target.classList.contains('key')) return;
    const key = e.target.getAttribute('data-key');

    // í¸ì§‘ê¸° ì»¤ì„œ ìœ„ì¹˜ì— íŠ¹ìˆ˜ë¬¸ì ì‚½ì…
    if(editor) {
      const selection = editor.getSelection();
      editor.executeEdits(null, [{
        range: selection,
        text: key,
        forceMoveMarkers: true
      }]);
      editor.focus();
    }
  });

  document.getElementById('openFolderBtn').addEventListener('click', openFolderOrFiles);
  document.getElementById('saveBtn').addEventListener('click', saveCurrentFile);
  document.getElementById('runBtn').addEventListener('click', runCode);

</script>

</body>
</html>
